# Nuxtå­¦ä¹ ä¹‹è·¯

## æ¦‚è¿°
```txt
vueå¼€å‘çš„SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ä¸åˆ©äºæœç´¢å¼•æ“çš„SEOä¼˜åŒ–ã€‚
Nuxt.js æ˜¯ä¸€ä¸ªåŸºäº Vue.js çš„é€šç”¨åº”ç”¨æ¡†æ¶,å®ƒé¢„è®¾äº†åˆ©ç”¨ Vue.js å¼€å‘ æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSR, Server Side Renderï¼‰çš„åº”ç”¨æ‰€éœ€è¦çš„å„ç§é…ç½®,åŒæ—¶ä¹Ÿå¯ä»¥ä¸€é”®ç”Ÿæˆé™æ€ç«™ç‚¹ã€‚é€šè¿‡å¯¹å®¢æˆ·ç«¯/æœåŠ¡ç«¯åŸºç¡€æ¶æ„çš„æŠ½è±¡ç»„ç»‡,Nuxt.js ä¸»è¦å…³æ³¨çš„æ˜¯åº”ç”¨çš„ UI æ¸²æŸ“ã€‚
```

## ä¼˜ç‚¹
* è‡ªåŠ¨ä»£ç åˆ†æˆ
* æœåŠ¡ç«¯æ¸²æŸ“
* å¼ºå¤§çš„è·¯ç”±åŠŸèƒ½,æ”¯æŒå¼‚æ­¥æ•°æ®
* ES6/ES7è¯­æ³•æ”¯æŒ,æ‰“åŒ…å’Œå‹ç¼©JSå’ŒCSS
* HTMLå¤´éƒ¨æ ‡ç­¾ç®¡ç†
* æœ¬åœ°å¼€å‘æ”¯æŒçƒ­åŠ è½½
* é›†æˆESLint
* æ”¯æŒå„ç§æ ·å¼é¢„å¤„ç†å™¨:SASSã€LESSç­‰

## åŸç†
![å›¾ç‰‡](./img/1.png)
1. ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ç½‘å€è¯·æ±‚åˆ°Node.js

2. éƒ¨ç½²åœ¨Node.jsçš„åº”ç”¨Nuxt.jsæ¥æ”¶æµè§ˆå™¨è¯·æ±‚ï¼Œå¹¶è¯·æ±‚æœåŠ¡ç«¯è·å–æ•°æ®

3. Nuxt.jsè·å–åˆ°æ•°æ®åè¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“

4. Nuxt.jså°†htmlç½‘é¡µå“åº”ç»™æµè§ˆå™¨

## è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®
1. å®‰è£…
```js
1.  yarn create nuxt-app <é¡¹ç›®å> 
2.  npx create-nuxt-app <é¡¹ç›®å>
```
2. è¿è¡Œ
```js
1. cd é¡¹ç›®ç›®å½•
2. yarn dev / npm run dev

æ³¨æ„ï¼š

   å¼€å‘æ—¶:
           yarn dev        npm run dev        --->å¼€å¯å¼€å‘æœåŠ¡å™¨

   å¼€å‘å®Œï¼š
   		   yarn build      npm run build      ---> æ‰“åŒ…
	       yarn start      npm run start      ---> å¼€å¯æ­£å¼æœåŠ¡å™¨

           yarn generate   npm run generate   ---> ç”Ÿæˆé™æ€é¡µ
				ç‰¹ç‚¹ï¼š  1. ç”Ÿæˆdist
                       2. ç”Ÿæˆ.htmlçš„é¡µé¢
```
3. ç›®å½•ä»‹ç»
![å›¾ç‰‡](./img/2.png)

## å¸ƒå±€
### é»˜è®¤å¸ƒå±€
* layouts/default.vue
```html
<template>
  <div>
    <header>é»˜è®¤å¸ƒå±€ç»„ä»¶å¤´éƒ¨</header>
    <NLink to="/">é¦–é¡µ</NLink>
    <NLink to="/about">å…³äº</NLink>
    <NLink to="/user">ç”¨æˆ·</NLink>
    <nuxt />
    <footer>é»˜è®¤å¸ƒå±€ç»„ä»¶åº•éƒ¨</footer>
  </div>
</template>
```
### è‡ªå®šä¹‰å¸ƒå±€
```html
<!-- layoutsä¸‹ -->
<template>
  <div>
      <nuxt />
      <p>è‡ªå®šä¹‰å¸ƒå±€</p>
  </div>
</template>
<!-- pagesä¸‹ ä½¿ç”¨è‡ªå®šä¹‰å¸ƒå±€ -->
<template>
  <div>
      <h2>æˆ‘æ˜¯å…³äºé¡µ</h2>
  </div>
</template>

<script>
export default {
    layout: 'custom'
}
</script>
```
**æ³¨æ„:**
```js
1. <nuxt /> è§†å›¾æ˜¾ç¤ºå ä½
2. <nuxt-link> = <n-link> = <NuxtLink> = <NLink> å°±æ˜¯aæ ‡ç­¾
3. ä¸€ä½†ä½¿ç”¨äº†è‡ªå®šä¹‰å¸ƒå±€çš„é¡µé¢,é»˜è®¤å¸ƒå±€åˆ™ä¸ç”Ÿæ•ˆã€‚
```
### é”™è¯¯é¡µé¢
* layouts/error.vue
```html
<template>
  <div>
    <h3>å°Šæ•¬çš„ç”¨æˆ·,æ‚¨è®¿é—®çš„é¡µé¢ä¸¢äº†</h3>
    <NLink to="/">é¦–é¡µ</NLink>
  </div>
</template>
```

## è·¯ç”±
* Nuxt.js ä¾æ® pages ç›®å½•ç»“æ„è‡ªåŠ¨ç”Ÿæˆ vue-router æ¨¡å—çš„è·¯ç”±é…ç½®ã€‚

1. è·¯ç”±åˆ‡æ¢æ¿€æ´»ç±»å
```js
nuxt-link-active  //æ¨¡ç³ŠåŒ¹é…
nuxt-link-exact-active //ç²¾ç¡®åŒ¹é…
```
2. è·¯ç”±å’Œæ–‡ä»¶çš„å…³ç³»
    | æ–‡ä»¶ | å¯¹åº”è·¯å¾„ |
    |--------|------|
    | pages/index.vue | / |
    | pages/about.vue | /about |
    | pages/user/index.vue | /user |
    | pages/user/details | /user/details |
    ![å›¾ç‰‡](./img/3.png) 

3. åŠ¨æ€è·¯ç”±
### è·¯å¾„å‚æ•°
![å›¾ç‰‡](./img/4.png) 
### æŸ¥è¯¢å‚æ•°
![å›¾ç‰‡](./img/5.png) 

4. åµŒå¥—è·¯ç”±
![å›¾ç‰‡](./img/6.png) 

``æ€»ç»“:``
* æ–‡ä»¶å¤¹çš„å±‚çº§å°±æ˜¯è·¯ç”±çš„åµŒå¥—å…³ç³»,è·¯å¾„æ–¹å¼å‚æ•°ä¼ é€’å•ä¸ª_å‚æ•°å.vue,å¤šä¸ªæ–‡ä»¶å¤¹åä¹Ÿè¦ä¸‹åˆ’çº¿å¼€å¤´ã€‚
* æŸ¥è¯¢æ–¹å¼å‚æ•°ä¼ é€’,ç›´æ¥ è·¯å¾„.vue,æ¥æ”¶$route.query.å‚æ•°åå³å¯ã€‚

## asyncData(å¼‚æ­¥æ•°æ®)

1. ä¼˜ç‚¹:Nuxt.js æ‰©å±•äº† Vue.jsï¼Œå¢åŠ äº†ä¸€ä¸ªå« `asyncData` çš„æ–¹æ³•,åœ¨è·å–é¡µé¢åˆå§‹åŒ–å¼‚æ­¥æ•°æ®æ—¶ä½¿ç”¨,è·å–çš„æ•°æ®ä¼šæ˜¾ç¤ºåœ¨é¡µé¢æºä»£ç ä¸­ï¼Œæœ‰åˆ©äºSEOã€‚
2. ä½•æ—¶è§¦å‘ï¼šè¯¥æ–¹æ³•`é™äºé¡µé¢ç»„ä»¶`,åŠ è½½ä¹‹å‰è¢«è°ƒç”¨ã€åˆ·æ–°åœ¨æœåŠ¡ç«¯è§¦å‘ã€è·¯ç”±æ›´æ–°åœ¨å®¢æˆ·ç«¯è§¦å‘ã€‚
3. process.server(æ˜¯å¦æ¥è‡ªæœåŠ¡ç«¯æ¸²æŸ“)ã€process.client(æ˜¯å¦æ¥è‡ªå®¢æˆ·ç«¯æ¸²æŸ“)
4. å‚æ•°: asyncData(context),contextæ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€‚
  * [é“¾æ¥] (https://www.nuxtjs.cn/api/context) 

5. è·å–å¼‚æ­¥æ•°æ®
```js
import axios from "axios";
export default {
  async asyncData() {
    const result = process.server; // true æœåŠ¡ç«¯ | false å®¢æˆ·ç«¯
    const {
      data: { data: topics }
    } = await axios.get("https://cnodejs.org/api/v1/topics");
    return {
      result,
      topics
    };
  }
};
```

## èµ„æºç›®å½•

* `assets` ç”¨äºç»„ç»‡æœªç¼–è¯‘çš„é™æ€èµ„æº
* `static` ç”¨äºå­˜æ”¾åº”ç”¨çš„é™æ€æ–‡ä»¶ï¼Œæ­¤ç±»æ–‡ä»¶ä¸ä¼šè¢« Nuxt.js è°ƒç”¨ Webpack è¿›è¡Œæ„å»ºç¼–è¯‘å¤„ç†

**æ³¨æ„:**
```html
  <!-- ~ ä»£è¡¨æ ¹ç›®å½• -->
  <img src="~/assets/imgs/1.jpg" alt="">
  <img src="~/static/imgs/3.jpg" alt="" />
  <!-- 
    ç±»åï¼šurl('~/assets/imgs/2.jpg')
    è¡Œå†…: url(${require("~/static/imgs/1.jpg")})
   -->
```

## é¢„å¤„ç†å™¨
* less ã€scss

1. å®‰è£…
```js
// less
yarn add less less-loader@7.3.0
// sass
yarn add -D sass sass-loader@10 fibers
```
2. å£°æ˜å˜é‡å’Œåˆ›å»ºå…¬å…±æ ·å¼æ–‡ä»¶
```css
/* lesså£°æ˜å˜é‡ */
@secondary:dodgerblue;
/* scss å£°æ˜å˜é‡*/
$secondary:dodgerblue;
```
```css
/* ä½¿ç”¨å˜é‡ */
h1 {
    color: @secondary; // ä½¿ç”¨å…¨å±€lesså˜é‡
}
h1 {
    color: $secondary; // ä½¿ç”¨scsså…¨å±€å˜é‡
}
```
3. å®‰è£…æ— éœ€å¯¼å…¥å°±ä½¿ç”¨å˜é‡çš„åŒ…
```js
yarn add -D @nuxtjs/style-resources
```
4. é…ç½®nuxt.config.js
```js
    css: [
            '~/assets/less/base.less',
            '~/assets/scss/base.scss'
    ],

// '@nuxtjs/style-resources' æ— éœ€å¼•å…¥ç›´æ¥ä½¿ç”¨lessã€sasså®šä¹‰çš„å…¨å±€å˜é‡
    buildModules: [
        '@nuxtjs/style-resources'
    ],
    // é…ç½®å…¨å±€lessã€scsså˜é‡
    styleResources: {
        less: ['~/assets/less/variables.less'],
        scss: ['~/assets/scss/variables.scss'],
    },
```

* pug(HTMLæ¨¡æ¿å¼•æ“)
1. å®‰è£…
```js
 yarn add -D pug pug-plain-loader
```
2. ä½¿ç”¨
```html
<template lang="pug">
  div
    h1 Hello Nuxters! ğŸ‘‹
    p This page uses less add scss
</template>
```

## ä¸­é—´ä»¶
* å®åˆ™å°±æ˜¯ä¸€ä¸ªå‡½æ•°,åœ¨æ¯ä¸€æ¬¡è¯·æ±‚è·¯ç”±ä¹‹å‰è¢«æ‰§è¡Œ

1. åˆ›å»º
```js
// åœ¨æ ¹ç›®å½•ä¸‹ åˆ›å»ºmiddlewareæ–‡ä»¶å¤¹å¹¶åˆ›å»ºjsæ–‡ä»¶
export default () => {
    const server = process.server ? 'æœåŠ¡ç«¯' : 'å®¢æˆ·ç«¯';
    console.log(`å…¨å±€ä¸­é—´ä»¶æ‰§è¡Œåœ¨${server}`);
}
```
2. é…ç½®
* å…¨å±€ä¸­é—´ä»¶
```js
// nuxt.config.js è¿›è¡Œé…ç½®
  router:{
    middleware:'globalkey'
  }
```
* å¸ƒå±€ä¸­é—´ä»¶
`layouts/å¸ƒå±€ç»„ä»¶ä¸­`
```js
export default {
  middleware:'layoutkey'
}
```
* é¡µé¢ä¸­é—´ä»¶
`pages/é¡µé¢ç»„ä»¶ä¸­`
```js
export default {
  middleware:'pagekey'
}
```
**æ€»ç»“:**
```txt
1. åˆæ¬¡åŠ è½½æˆ–åˆ·æ–°ï¼Œä¸­é—´ä»¶æ‰§è¡Œåœ¨æœåŠ¡ç«¯,è·¯ç”±åˆ‡æ¢æ‰§è¡Œåœ¨å®¢æˆ·ç«¯
2. æ‰§è¡Œé¡ºåºï¼šå…¨å±€ä¸­é—´ä»¶ ã€‹å¸ƒå±€ä¸­é—´ä»¶ ã€‹é¡µé¢ä¸­é—´ä»¶
```


## æ’ä»¶

1. å®šä¹‰
`æ’ä»¶å°±æ˜¯ä¸€ä¸ªjsæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šåœ¨æ¯æ¬¡åˆ·æ–°é¡µé¢æ—¶éƒ½ä¼šåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ‰§è¡Œä¸€éã€‚`
2. è¿ç”¨
* 2.1åˆ›å»ºæ’ä»¶
```js
// æ ¹ç›®å½•ä¸‹ åˆ›å»ºpluginsæ–‡ä»¶å¤¹å¹¶åˆ›å»ºjsæ–‡ä»¶
import Vue from 'vue';
import { Button } from 'vant';
import 'vant/lib/index.css';
Vue.use(Button)
```
* 2.2é…ç½®ä½¿ç”¨æ’ä»¶
```js
  plugins: [
        // ç›´æ¥å†™è·¯å¾„ä¸¤ç«¯éƒ½ä¼šæ‰§è¡Œ
        // '~/plugins/vant', 

        // é€šè¿‡ mode æ¥è®¾ç½®æ’ä»¶æ‰§è¡Œåœ¨å“ªä¸€ç«¯   client(å®¢æˆ·ç«¯)ã€server(æœåŠ¡ç«¯)ã€both(ä¸¤ç«¯)
        { src: '~/plugins/vant', mode: 'both' },
        { src: '~/plugins/axios', mode: 'both' },
  ],
```
### axiosæ’ä»¶
```js
import axios from "axios";
export default (context,inject)=>{
  // åŸºå‡†è·¯å¾„
  axios.defaults.baseURL = 'https://cnodejs.org/api/v1';
  inject('api',{
    getTopics (path) {
        return axios.get(`${path}`);
    }
  })
}

// ç»„ä»¶ä¸­ä½¿ç”¨
async asyncData({ app}) {
    const {
      data: { data: topics },
    } = await app.$api.getTopics("/topics");
    return {
      topics,
    };
  },
```

## vuex
* nuxtå†…ç½®äº†vuex,å’Œvueæ—¶æœŸçš„ä¸åŒä¹‹å¤„,éœ€è¦å°†state(å‡½æ•°)ã€mutationsã€actionsã€gettersä½¿ç”¨exportå¯¼å‡ºå»ã€‚
* æ¨¡å—åŒ–ï¼Œåœ¨ä½¿ç”¨mapStateä¸Šéœ€è¦æ³¨æ„mapState(æ¨¡å—åç§°,['æ•°æ®'])

1. åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºstoreæ–‡ä»¶å¤¹æ ¹æ–‡ä»¶index.js
```js
// åœ¨åŒä¸€ç»„ä»¶ä¸­ä½¿ç”¨å¤šä¸ªæ¨¡å—çš„å˜é‡æ—¶ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨gettersç»Ÿä¸€ç®¡ç†æ•°æ®
export const getters = {
    count: state => state.random.count,
    list: state => state.toList.list,
}
```
```js
// æ¨¡å—ä¸€
export const state = () => {
    return {
        count: 0
    }
}
export const mutations = {
    updataCount(state, payload) {
        state.count = payload;
    }
}
// æ¨¡å—äºŒ
export const state = () => {
    return {
        list: [10, 20, 30]
    }
}


export const mutations = {
    updataList(state, payload) {
        state.list.push(payload)
    }
}

export const actions = {
    asyncUpdataList({ commit }, payload) {
        setTimeout(function() {
            commit('updataList', payload)
        }, 1000)
    }
}
// æ¨¡å—ä¸‰
const state = () => {
    return {
        title: 'æ¥äº†è€å¼Ÿ'
    }
}

const mutations = {
    updataTitle(state, payload) {
        state.title = payload
    }
}

export default {
    state,
    mutations
}
```
2. ä½¿ç”¨
```html
<template>
  <div>
    <h1>{{ count }}</h1>
    <p>{{ list }}</p>
    <span>{{title}}</span><br/>
    <button @click="handleNum">ç”Ÿæˆéšæœºæ•°</button>
    <button @click="gxin('nuxtä¸é”™,666!')">æ¢æç¤ºè¯­</button>
  </div>
</template>

<script>
import { mapState, mapGetters, mapMutations } from "vuex";
export default {
  computed: {
    ...mapState("msg", ["title"]),
    ...mapGetters(["count", "list"])
  },
  methods: {
    ...mapMutations({ gxin: "msg/updataTitle" }),
    handleNum() {
      // éšæœºæ•°
      const random = this.getRandom(10, 100);
      // åŒæ­¥ä¿®æ”¹
      this.$store.commit("random/updataCount", random);
      // å¼‚æ­¥ä¿®æ”¹
      this.$store.dispatch("toList/asyncUpdataList", random);
    },
    // ç”Ÿæˆéšæœºæ•°
    getRandom(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min);
    }
  }
};
</script>
```





