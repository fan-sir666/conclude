# **项目总结**

## **初始化项目**
1. 创建项目,删除无关文件
2. 配置antDesignVue框架
[官网] (https://2x.antdv.com/docs/vue/getting-started-cn/) 
```shell
npm i --save ant-design-vue@next
```
3. main入口文件 导入相关文件
```js
import Antd from 'ant-design-vue';
import 'ant-design-vue/dist/antd.css';
// 挂载
createApp(App)
  .use(Antd)
  .mount("#app");
```
## **登录**
### 登录路由 (roeter文件夹下)
```js
// 导入登录组件
import Login from "../views/Login.vue";
const routes = [
    // 重定向
    { path: '/', redirect: '/login' },
    // 登录
    { path: '/login', component: Login }
];
```
### 创建登录组件 (views文件夹下)
```vue
<template>
  <!-- 框架布局 flex  -->
  <a-layout>
    <a-layout-header></a-layout-header>
    <a-layout-content>
      <!-- 登录框 -->
      <a-row>
        <a-col :span="6" :offset="9" class="box">
          <!-- form表单 -->
          <a-form :model="form" :rules="rules" ref="loginForm">
            <!-- 表单头部 -->
            <a-row class="login-title">
              <a-col :span="24">
                <h2>
                  <img src="../assets/image/logo.png" alt="" />后台管理系统
                </h2>
                <span>Ant Design 是西湖区最具影响力的 Web 设计规范</span>
              </a-col>
            </a-row>

            <!-- 登录方式 -->
            <a-row class="login-way">
              <a-col :span="24">
                <!-- tabs标签页  -->
                <a-tabs :tabBarStyle="{ textAlign: 'center' }">
                  <!-- 账号密码登录 -->
                  <a-tab-pane key="1" tab="账号密码登录">
                    <!-- 账号 -->
                    <a-form-item :wrapperCol="{ span: 24 }" name="username">
                      <a-input
                        size="large"
                        type="text"
                        placeholder="请输入用户名"
                        v-model:value="form.username"
                      >
                        <template #prefix
                          ><UserOutlined style="color: rgba(0, 0, 0, 0.25)"
                        /></template>
                      </a-input>
                    </a-form-item>
                    <!-- 密码 -->
                    <a-form-item :wrapperCol="{ span: 24 }" name="password">
                      <a-input-password
                        size="large"
                        type="password"
                        v-model:value="form.password"
                        placeholder="请输入密码"
                      >
                        <template #prefix
                          ><LockOutlined style="color: rgba(0, 0, 0, 0.25)"
                        /></template>
                      </a-input-password>
                    </a-form-item>
                  </a-tab-pane>
                  <!-- 手机号登录 -->
                  <a-tab-pane key="2" tab="手机号登录">
                    <!-- 手机号 -->
                    <a-form-item :wrapperCol="{ span: 24 }">
                      <a-input
                        size="large"
                        type="text"
                        placeholder="请输入手机号"
                      >
                        <template #prefix
                          ><MobileOutlined style="color: rgba(0, 0, 0, 0.25)"
                        /></template>
                      </a-input>
                    </a-form-item>
                    <!-- 验证码 -->
                    <a-row :gutter="16">
                      <a-col :span="16">
                        <a-form-item :wrapperCol="{ span: 24 }">
                          <a-input
                            size="large"
                            type="text"
                            placeholder="请输入验证码"
                          >
                            <template #prefix
                              ><MailOutlined style="color: rgba(0, 0, 0, 0.25)"
                            /></template>
                          </a-input>
                        </a-form-item>
                      </a-col>
                      <a-col :span="8">
                        <a-button
                          type="primary"
                          block
                          size="large"
                          style="padding: 0"
                          >获取验证码</a-button
                        >
                      </a-col>
                    </a-row>
                  </a-tab-pane>
                </a-tabs>
              </a-col>
            </a-row>
            <!-- 忘记密码 -->
            <a-row>
              <a-col :span="7">
                <a-checkbox> 自动登录 </a-checkbox>
              </a-col>
              <a-col :span="6" offset="11" :style="{ textAlign: 'right' }">
                <router-link to="">忘记密码?</router-link>
              </a-col>
            </a-row>

            <!-- 确定按钮 -->
            <a-row :style="{ marginTop: '20px' }">
              <a-col :span="24">
                <a-form-item :wrapperCol="{ span: 24 }">
                  <a-button type="primary" block size="large" @click="jYan"
                    >确定</a-button
                  >
                </a-form-item>
              </a-col>
            </a-row>

            <!-- 其他登录方式 -->
            <a-row>
              <a-col :span="16">
                <span style="margin-right: 5px">其他登录方式</span>
                <AlipayCircleOutlined class="login-icon" />
                <TaobaoCircleOutlined class="login-icon" />
                <WeiboCircleOutlined class="login-icon" />
              </a-col>
              <a-col :span="6" offset="2" :style="{ textAlign: 'right' }">
                <router-link to="">注册账号</router-link>
              </a-col>
            </a-row>
          </a-form>
        </a-col>
      </a-row>
    </a-layout-content>
  </a-layout>
</template>

<script>
// 导入图标
import {
  UserOutlined,
  LockOutlined,
  MobileOutlined,
  MailOutlined,
  AlipayCircleOutlined,
  TaobaoCircleOutlined,
  WeiboCircleOutlined
} from "@ant-design/icons-vue";
export default {
  data() {
    return {
      form: {
        username: "",
        password: ""
      },
      rules: {
        username: [
          { required: true, message: "请输入用户名", trigger: "blur" },
          { min: 4, max: 16, message: "长度在4-16个字符之间", trigger: "blur" }
        ],
        password: [
          { required: true, message: "请输入密码", trigger: "blur" },
          { min: 6, max: 18, message: "长度在6-18个字符之间", trigger: "blur" }
        ]
      }
    };
  },
  methods: {
    jYan() {
      this.$refs.loginForm
        .validate()
        .then(() => {
          console.log("values", this.form);
        })
        .catch(error => {
          console.log("error", error);
        });
    }
  },
  components: {
    UserOutlined,
    LockOutlined,
    MobileOutlined,
    MailOutlined,
    AlipayCircleOutlined,
    TaobaoCircleOutlined,
    WeiboCircleOutlined
  }
};
</script>

<style scoped>
.ant-layout {
  height: 100%;
  background-image: url("../assets/image/bg.svg");
}

.ant-layout-header {
  background-color: transparent;
}
/* 辅助样式 */
/* .box {
  height: 500px;
  background-color: red;
} */

.ant-form {
  width: 366px;
  margin: 0 auto;
  /* border: 1px solid #cccccc; */
}
.login-title {
  text-align: center;
}

.login-title h2 {
  font-size: 34px;
  color: rgba(0, 0, 0, 0.85);
  font-weight: 700;
  font-family: Avenir, Helvetica Neue, Arial, Helvetica, sans-serif;
}

.login-title img {
  height: 44px;
}

.login-title span {
  margin-top: 12px;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.45);
}

.login-icon {
  margin: 0 5px;
  font-size: 24px;
  color: rgba(0, 0, 0, 0.2);
}

.login-icon:hover {
  color: #1890ff;
}
</style>

```
### 实现登录
1. 配置axios (main入口文件)
```shell
npm i axios@next
```
```js
import { createApp } from "vue";
import App from "./App.vue";
import router from "./router";

// 导入ant-design-vue
import Antd from "ant-design-vue";
import "ant-design-vue/dist/antd.css";

// 导入axios
import axios from "axios";
// 创建 app 实例
const app = createApp(App);
// 配置基本路径
axios.defaults.baseURL = "http://www.wanlum.com:8888/api/private/v1/";
// 挂载axios
app.config.globalProperties.$axios = axios;

app
    .use(router)
    .use(Antd)
    .mount("#app");
```
2. 前台校验成功 整理要传给后台的参数 发送post请求 将后台返回的token保存在sessionStorage中(views/Login)
```vue
<script>
// 导入图标
import {
  UserOutlined,
  LockOutlined,
  MobileOutlined,
  MailOutlined,
  AlipayCircleOutlined,
  TaobaoCircleOutlined,
  WeiboCircleOutlined,
} from "@ant-design/icons-vue";
// 导入全局提示
import { message } from "ant-design-vue";
export default {
  data() {
    return {
      form: {
        username: "",
        password: "",
      },
      rules: {
        username: [
          { required: true, message: "请输入用户名", trigger: "blur" },
          { min: 4, max: 16, message: "长度在4-16个字符之间", trigger: "blur" },
        ],
        password: [
          { required: true, message: "请输入密码", trigger: "blur" },
          { min: 6, max: 18, message: "长度在6-18个字符之间", trigger: "blur" },
        ],
      },
    };
  },
  methods: {
    jYan() {
      this.$refs.loginForm
        .validate()
        // 校验成功
        .then(() => {
          // console.log("values", this.form);
          // console.log(this);
          // 收集参数
          let params = {
            username: this.form.username,
            password: this.form.password,
          };
          // 发送axios请求
          this.$axios
            .post("/login", params)
            .then((response) => {
              let res = response.data;
              // console.log(res);
              if (res.meta.status == 200) {
                // 登录成功提示语
                message.success(res.meta.msg);
                // 将后台发来的token 存到 sessionStorage 中
                window.sessionStorage.setItem("token", res.data.token);
                // 跳转到首页 /home
                this.$router.push("/home");
              } else if (res.meta.status == 400) {
                return message.error(res.meta.msg);
              }
            })
            .catch((error) => {
              console.log(error);
            });
        })
        // 校验失败
        .catch((error) => {
          console.log("error", error);
        });
    },
  },
  components: {
    UserOutlined,
    LockOutlined,
    MobileOutlined,
    MailOutlined,
    AlipayCircleOutlined,
    TaobaoCircleOutlined,
    WeiboCircleOutlined,
  },
};
</script>
```
3. 在router文件下设置路由守卫
```js
// 定义路由导航守卫
// to: 代表我要去哪个个路由
// from: 代表我来自于哪个路由
// next代表: 下一步要去哪里 如果next() 代表放行  如果next("/login")代表必须跳转到login这个路由
router.beforeEach((to, from, next) => {
  // 获取token
  let isAuthenticated = window.sessionStorage.getItem("token");
  // 如果将要去的地方 不是Login 且没有授权 要强制跳转到Login页面
  if (to.name !== 'Login' && !isAuthenticated) next({ name: 'Login' })
  else next()
})
```